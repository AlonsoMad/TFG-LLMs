{% extends "base.html" %}
{% block title %}Profile{% endblock %}

{% block content %}
<h1 class="mt-5"> {{ user.user }}'s profile  </h1>

<h2 class="mt-3">Labeled data</h2>
    {% if datasets %}
        {% for dataset in datasets %}
            <div class="card mb-3">
                <div class="card-header">
                    <h5 class="mb-0">{{ dataset.name }}</h5>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <p class="text-muted">No labeled data available.</p>

    {% endif %}
<h2 class="mt-3">My Datasets</h2>
<p class="text-muted">Upload your dataset files (.parquet, .xlsx, .csv)</p>

<form id="upload-form" action="{{ url_for('views.upload_dataset') }}" method="POST" enctype="multipart/form-data">
    <div class="border rounded p-4 text-center bg-light" id="drop-zone">
        <p class="mb-2">Drag & drop your file here, or click to select</p>
        <input type="file" name="dataset_file" id="file-input" class="d-none" accept=".parquet,.xlsx,.csv" required>
        <button type="button" class="btn btn-outline-primary btn-sm" id="browse-btn">Choose File</button>
        <p class="mt-2 text-muted" id="file-name"></p>
    </div>
    <div class="text-right mt-3">
        <button type="submit" class="btn btn-success" id="btn-success-files">Upload Dataset</button>
    </div>
</form>

<h2 class="mt-3">Update information</h2>
<form method="POST" action="/profile">
    <div class="form-group">
        <label for="username">Username</label>
        <input type="text" class="form-control" id="username" name="username" placeholder="{{ user.user }}" >
    </div>
    <div class="form-group">
        <label for="email">Email address</label>
        <input type="email" class="form-control" id="email" name="email" placeholder="{{ user.email }}" >
    </div>
    <div class="form-group">
        <label for="password">Password</label>
        <input type="password" class="form-control" id="password" name="password" >
    </div>
    <div class="form-group">
        <label for="password">Confirm password</label>
        <input type="password" class="form-control" id="password_rep" name="password_rep" >
    </div>
    <button type="submit" class="btn btn-primary">Sign Up</button>
</form>

<script>
function uploadFile() {
    const file = document.getElementById('file-input').files[0];
    if (!file) return alert("Please select a file first.");

    const formData = new FormData();
    formData.append('file', file);

    fetch('/upload_dataset', {
        method: 'POST',
        body: formData
    })
    .then(res => res.json())
    .then(data => alert(data.message || data.error))
    .catch(err => console.error(err));
}

document.addEventListener('DOMContentLoaded', function () {
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-input');
    const browseBtn = document.getElementById('browse-btn');
    const fileNameDisplay = document.getElementById('file-name');
    const inputBtn = document.getElementById('btn-success-files');

    browseBtn.addEventListener('click', () => fileInput.click());

    fileInput.addEventListener('change', () => {
        fileNameDisplay.textContent = fileInput.files[0]?.name || '';
    });

    dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('border-primary');
    });

    dropZone.addEventListener('dragleave', () => {
        dropZone.classList.remove('border-primary');
    });

    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('border-primary');
        if (e.dataTransfer.files.length) {
            fileInput.files = e.dataTransfer.files;
            fileNameDisplay.textContent = e.dataTransfer.files[0].name;
        }
    });

    inputBtn.addEventListener('click', uploadFile);

});

</script>

<!-- <script src="http://localhost:3000/static/js/profile.js" ></script> -->


{% endblock %}