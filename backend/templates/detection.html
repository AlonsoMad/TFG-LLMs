{% extends "base.html" %}
{% block title %}Detection{% endblock %}

{% block content %}
<h1>MIND Cultural discrepancy detection</h1>
<div class="jumbotron" style="min-height: 50vh; overflow-y: auto; padding: 2rem;">
    {% if status in ['idle', 'initializing'] %}
        <p class="lead">MIND is currently idle. Start a session by selecting a dataset:</p>
        
        {% if ds_tuple and ds_tuple[0] %}
            <ul class="list-group dataset-list">
                {% for dataset in ds_tuple[1] %}
                    <li class="list-group-item dataset-item hover-text-primary">
                        {{ dataset }}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="lead">No datasets found or error loading datasets.</p>
        {% endif %}

    {% elif status == 'initialized' or status == 'topic_exploration' %}
        {% if not mind_info %}
            <p class="lead">MIND is initialized.</p>
            <p>Inspect the available topics or start analysis.</p>
        {% else %}
            <div class="card shadow-sm mb-4" id="topic-list-card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Available topics for exploration</h5>
                </div>
                <div class="card-body p-0" style="max-height: 400px; overflow-y: auto;">
                    <ul class="list-group list-group-flush">
                        {% for topic in mind_info %}
                            <li class="list-group-item d-flex justify-content-between align-items-start">
                                <div>
                                    <strong>Topic {{ topic["Topic #"] }}:</strong>
                                    <span class="text-muted">{{ topic["Key words"] }}</span>
                                </div>
                                <!-- Optional action button -->
                                <button class="btn btn-sm btn-outline-primary topic_button" data-topic-id="{{ topic['Topic #'] }}">Select</button>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            <div class="card shadow-sm mb-4 d-none" id="document-carousel-card">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0">Documents for selected topic</h5>
                </div>
                <div class="card-body">
                    <div id="document-carousel" class="carousel slide" data-ride="carousel">
                        <div class="carousel-inner" id="carousel-inner">
                            <!-- JS will populate this -->
                        </div>
                        <!-- <a class="carousel-control-prev" href="#document-carousel" role="button" data-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="sr-only">Previous</span>
                        </a>
                        <a class="carousel-control-next" href="#document-carousel" role="button" data-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="sr-only">Next</span> -->
                        </a>
                    </div>
                </div>
            </div>
        {% endif %}

    {% elif status == 'running' %}
        <p class="lead">MIND is currently running...</p>

    {% endif %}
</div>

<ul class="nav nav-pills mb-4 d-flex justify-content-between w-100" id="myTab" role="tablist">
    <li class="nav-item ">
        <a class="nav-link mode-selectors active " href="#input" data-toggle="tab">Explore topics</a>
    </li>
    <li class="nav-item ">
        <a class="nav-link mode-selectors active" href="#output" data-toggle="tab">Analyze contradictions</a>
    </li>
</ul>
<div class="d-flex justify-content-between align-items-center mb-4 flex-wrap">
  <!-- Navigation Pills -->
  <ul class="nav nav-pills mb-2 mb-md-0" id="myTab" role="tablist">
      <li class="nav-item">
          <a class="nav-link control active" id="prev-doc" data-toggle="tab">Previous</a>
      </li>
      <li class="nav-item">
          <a class="nav-link control" id="next-doc" data-toggle="tab">Next</a>
      </li>
      <li class="nav-item">
          <a class="nav-link control" id="return-btn" data-toggle="tab">Return</a>
      </li>
  </ul>

  <!-- Inline Form -->
  <form id="mind-number-form" class="form-inline d-flex align-items-center gap-2">
    <label for="numberInput" class="mr-2 mb-0"></label>
    <!-- Max input = ntopics -->
    <input type="number" class="form-control mr-2" id="numberInput" placeholder="0" min="0" style="width: 100px;">
    <button type="submit" class="btn btn-primary">Submit</button>
  </form>
</div>

<script>
    console.log("✅ Script block is rendering.");
</script>

<script src="http://localhost:3000/static/js/mind.js" ></script>
<!-- <script>
  function fetchMindStatus() {
    fetch("/detection")
      .then((res) => res.json())
      .then((data) => {
        document.getElementById("mind-status").textContent = data.state || "unknown";

        // Optionally flash messages or update UI
        if (data.state === "completed") {
          console.log("✅ MIND finished processing.");
        }
      })
      .catch((err) => {
        document.getElementById("mind-status").textContent = "error";
        console.error("Error fetching MIND status:", err);
      });
  }

  // Poll every 5 seconds
  setInterval(fetchMindStatus, 5000);
  fetchMindStatus();  // initial load
</script> -->
{% if csrf_token %}
<script>
    document.cookie = "csrf_token={{ csrf_token }}";
</script>
{% endif %}
<style>
.hover-text-primary:hover {
    color: #007bff;
    cursor: pointer;
}
</style>


{% endblock %}


